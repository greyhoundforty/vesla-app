services:
  vesla-api:
    build: .
    container_name: vesla-api
    restart: unless-stopped
    
    # Run as vesla user with docker group access
    user: "${VESLA_UID:-1000}:${DOCKER_GID:-999}"
    
    networks:
      - vesla-network
    
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./config.yaml:/app/config.yaml:ro
    
    env_file:
      - .env
    
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.vesla-api.rule=Host(`api.vesla-app.site`)"
      - "traefik.http.routers.vesla-api.entrypoints=websecure"
      - "traefik.http.routers.vesla-api.tls.certresolver=digitalocean"
      - "traefik.http.services.vesla-api.loadbalancer.server.port=5001"

networks:
  vesla-network:
    external: true
